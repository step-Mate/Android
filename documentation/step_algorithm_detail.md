# 용어정리

1. 어제값 = 어제걸음수
2. 센서값 = 합계 센서에 의해 측정된 걸음수값
3. 오늘값 = 계산되어진 오늘의 걸음수
4. missedTodayStepAfterReboot = 재부팅 혹은 그에 상응하는 사건에 의해 누락된 걸음수

# 배경 지식

- 걸음수 합계 센서의 값은 휴대폰 부팅 이후 걸음이 감지 될 때 마다 1씩 증가된 값이다.
- 합계된 센서값을 토대로 오늘의 걸음수를 계산하여야 한다.
- 서비스는 시스템에 의해 언제든지 종료후 재실행 될 수 있으므로, 상태를 관리하기 위해 디스크에 저장한다.
- 헬스커넥트 api 를 이용하여 걸음수를 일정 기간 단위로 묶어서 저장하고 복원하여 차트로 통계화 하는 등의 기능에 사용한다.

# 목표

1. 걸음수 센서의 콜백 마다 센서값에서 어제값을 빼야 한다.
2. 포그라운드 서비스는 시스템에 의해 언제든지 종료후 재시작 될 수 있다. (서비스의 onStartCommand(intent) 의 intent 가 null 이 된다)
3. 휴대폰을 재부팅 하면, 센서값이 0으로 초기화 된다.
    1. 센서값이 초기화 되므로, 오늘의 걸음수가 사라질 수 있어 따로 저장 후 이후의 로직에서 별도로 더해주어야 한다.(missedTodayStepAfterReboot)
    2. 센서값이 초기화 되므로, 어제값(어제걸음수) 를 0으로 똑같이 초기화 시켜 디스크에 저장해야 한다.
4. 하루가 지나면, 오늘값을 0으로 초기화 해주어야 한다.
    - 따라서 어제값에 현재의 센서값을 저장해 주어야 한다.
5. 걸음수는 1분 타이머가 완료될 때 마다 헬스커넥트에 누적된 형태로 저장해 준다.
    1. 2번항목 에 의해 타이머가 완료되지 않아 저장되지 않은 걸음수가 누락될 수 있으므로, 계산된 오늘의 걸음수값을 걸음수 센서 콜백 마다 디스크에 저장해준다.
6. 포그라운드 서비스가 생성(create) 될 때, 현재의 센서값을 어제값으로 디스크에 저장해야 한다.
    1. 이전 실행 시점 이후 당일에 재실행 했다면, missedTodayStepAfterReboot에 저장된 헬스커넥트의 걸음수를 저장한다.
    2. 앱 설치 이후 최초 이거나 이전 실행 시점 이후 다음날 재실행 했다면, missedTodayStepAfterReboot 에 0을 저장한다.